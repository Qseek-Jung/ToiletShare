const K=(c,a)=>{const n=/(B?\d+)층|(B?\d+)F|지하(\d+)층/i;let s=1,d=c.trim(),e=a.trim();const i=d.match(n);if(i&&(i[1]&&(s=parseInt(i[1])),i[2]&&(s=parseInt(i[2])),i[3]&&(s=-parseInt(i[3])),d=d.replace(n,"").trim()),s===1){const r=e.match(n);r&&(r[1]&&(s=parseInt(r[1])),r[2]&&(s=parseInt(r[2])),r[3]&&(s=-parseInt(r[3])))}return d&&!e.includes(d)&&(e=`${e} ${d}`),{name:d,address:e,floor:s,nameRaw:c,addressRaw:a}},j=(c,a,n,s,d)=>{var x,I;const e=[],{name:i,address:r,floor:h,nameRaw:$,addressRaw:L}=c;h!==1&&e.push({message:`층수 추출됨: ${h}층`,type:"info"}),r!==L&&e.push({message:`주소 보정됨: ${r}`,type:"info"});const y=["공원","운동장","학교","캠퍼스","대학교","초등학교","중학교","고등학교","체육관","경기장","수변","광장","유원지"].some(B=>i.includes(B));e.push({message:`타입 분류: ${y?"넓은 구역":"건물/기관"}`,type:"info"});let f=a,p=n,o="review",t="";const F=a!==0&&n!==0;if(!s)return F?d?(o="immediate",t="지오코딩 실패했으나 원본 좌표가 유효(육지)하여 즉시 등록",e.push({message:t,type:"warning"})):(o="reject",t="지오코딩 실패 및 원본 좌표 오류(바다/해외)",e.push({message:t,type:"error"})):(o="reject",t="주소 불명 및 좌표 없음",e.push({message:t,type:"error"})),{name:i,address:r,floor:h,lat:f,lng:p,action:o,reason:t,logs:e};const l=parseFloat(s.y),g=parseFloat(s.x);(x=s.road_address)!=null&&x.address_name||s.address.address_name;const M=((I=s.road_address)==null?void 0:I.building_name)||"";if(!F)return o="immediate",f=l,p=g,t="원본 좌표 없어 주소 기반 좌표로 즉시 등록",e.push({message:t,type:"success"}),{name:i,address:r,floor:h,lat:f,lng:p,action:o,reason:t,logs:e};const m=_(a,n,l,g)*1e3;e.push({message:`좌표 거리 차이: ${m.toFixed(1)}m`,type:"info"});const v=M&&i.includes(M);return y?m<=200?(o="immediate",f=a,p=n,t=`넓은 구역, 거리(${m.toFixed(0)}m) 양호 -> 즉시 등록`):(o="review",f=a,p=n,t=`넓은 구역, 거리 차이(${m.toFixed(0)}m) 과다 -> 검수 필요`):m<=50||v?(o="immediate",f=a,p=n,v&&m>50?(t=`거리(${m.toFixed(0)}m)는 멀지만 건물명 일치(${M}) -> 즉시 등록`,e.push({message:"건물명 일치 확인",type:"success"})):t=`거리(${m.toFixed(0)}m) 양호 -> 즉시 등록`):m<=150?(o="review",f=a,p=n,t=`거리 차이(${m.toFixed(0)}m) 발생 (50~150m) -> 검수 필요`):(o="review",f=l,p=g,t=`거리 차이(${m.toFixed(0)}m) 과다 -> 검수 필요`),{name:i,address:r,floor:h,lat:f,lng:p,action:o,reason:t,logs:e}};function _(c,a,n,s){var d=6371,e=u(n-c),i=u(s-a),r=Math.sin(e/2)*Math.sin(e/2)+Math.cos(u(c))*Math.cos(u(n))*Math.sin(i/2)*Math.sin(i/2),h=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),$=d*h;return $}function u(c){return c*(Math.PI/180)}export{K as parseBulkRow,j as validateBulkItem};
