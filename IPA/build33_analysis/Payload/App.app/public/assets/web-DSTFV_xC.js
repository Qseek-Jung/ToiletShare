var r=(l,e,t)=>new Promise((s,n)=>{var o=i=>{try{c(t.next(i))}catch(d){n(d)}},a=i=>{try{c(t.throw(i))}catch(d){n(d)}},c=i=>i.done?s(i.value):Promise.resolve(i.value).then(o,a);c((t=t.apply(l,e)).next())});import{W as g}from"./index-BsQCTjw0.js";class h extends g{constructor(){super()}loadScript(){if(typeof document=="undefined")return;const e="gapi";if(document==null?void 0:document.getElementById(e))return;const s=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.defer=!0,n.async=!0,n.id=e,n.onload=this.platformJsLoaded.bind(this),n.src="https://apis.google.com/js/platform.js",s.appendChild(n)}initialize(e={clientId:"",scopes:[],grantOfflineAccess:!1}){var t,s;if(typeof window=="undefined")return;const n=(t=document.getElementsByName("google-signin-client_id")[0])===null||t===void 0?void 0:t.content,o=e.clientId||n||"";return o||console.warn("GoogleAuthPlugin - clientId is empty"),this.options={clientId:o,grantOfflineAccess:(s=e.grantOfflineAccess)!==null&&s!==void 0?s:!1,scopes:e.scopes||[]},this.gapiLoaded=new Promise(a=>{window.gapiResolve=a,this.loadScript()}),this.addUserChangeListener(),this.gapiLoaded}platformJsLoaded(){gapi.load("auth2",()=>{const e={client_id:this.options.clientId,plugin_name:"CodetrixStudioCapacitorGoogleAuth"};this.options.scopes.length&&(e.scope=this.options.scopes.join(" ")),gapi.auth2.init(e),window.gapiResolve()})}signIn(){return r(this,null,function*(){return new Promise((e,t)=>r(this,null,function*(){var s;try{let n;const o=(s=this.options.grantOfflineAccess)!==null&&s!==void 0?s:!1;o?n=(yield gapi.auth2.getAuthInstance().grantOfflineAccess()).code:yield gapi.auth2.getAuthInstance().signIn();const a=gapi.auth2.getAuthInstance().currentUser.get();o&&(yield a.reloadAuthResponse());const c=this.getUserFrom(a);c.serverAuthCode=n,e(c)}catch(n){t(n)}}))})}refresh(){return r(this,null,function*(){const e=yield gapi.auth2.getAuthInstance().currentUser.get().reloadAuthResponse();return{accessToken:e.access_token,idToken:e.id_token,refreshToken:""}})}signOut(){return r(this,null,function*(){return gapi.auth2.getAuthInstance().signOut()})}addUserChangeListener(){return r(this,null,function*(){yield this.gapiLoaded,gapi.auth2.getAuthInstance().currentUser.listen(e=>{this.notifyListeners("userChange",e.isSignedIn()?this.getUserFrom(e):null)})})}getUserFrom(e){const t={},s=e.getBasicProfile();t.email=s.getEmail(),t.familyName=s.getFamilyName(),t.givenName=s.getGivenName(),t.id=s.getId(),t.imageUrl=s.getImageUrl(),t.name=s.getName();const n=e.getAuthResponse(!0);return t.authentication={accessToken:n.access_token,idToken:n.id_token,refreshToken:""},t}}export{h as GoogleAuthWeb};
